# Ohelp2025 演示说明（含测试点）

本文档用于“本地演示 + 功能测试走查”。内容以当前仓库实际前后端能力为准（Vue3 前端模块页 + Spring Boot 后端接口）。

---

## 1. 本地启动与访问地址

### 1.1 前置条件

- JDK 17
- Node.js 16+
- MySQL 8.x（或兼容版本）

### 1.2 初始化数据库

1) 创建数据库并建表：执行后端 DDL
- 文件：o-b/database_schema.sql

2) 插入演示数据：执行初始化数据
- 文件：o-b/database_init_data.sql

> 如果你的 MySQL 连接信息不是默认值，请同步修改后端配置：o-b/src/main/resources/application.properties

### 1.3 启动后端（Windows）

在项目根目录打开终端：

- `cd o-b`
- `./mvnw.cmd -U -DskipTests spring-boot:run`

后端默认地址：
- `http://localhost:8080/api`

### 1.4 启动前端（Windows）

- `cd o-f`
- `npm install`
- `npm run dev`

前端默认地址：
- `http://localhost:5173/`

---

## 2. 登录账号（演示数据）

这些账号来自初始化数据脚本（o-b/database_init_data.sql）。

| 账号 | 密码 | userId | 后端 User.role | 前端宏角色 | 登录后默认跳转 |
|---|---|---:|---|---|
| admin | admin123 | 1 | admin | ADMIN | /admin |
| manager | manager123 | 2 | manager | WORKER | /worker |
| staff | staff123 | 3 | staff | WORKER | /worker |
| user | user123 | 4 | user | USER | /app |

说明：
- 前端只做“是否登录”的判断：localStorage 里有 token 就视为已登录。
- 登录接口不返回 role，前端会在登录后用 userId 调用用户详情接口获取 `User.role`。
- 前端会把后端 role 归一化为宏角色（ADMIN/WORKER/USER），并只保存宏角色到 localStorage['role']。
- 前端不实现 RBAC/权限校验/只读限制；路由守卫只做“未登录跳转 /login”。

补充（USER 端视角判定规则，仅前端展示差异，不新增角色/路由分支）：
- 若当前用户“绑定 elderly”（前端通过手机号匹配 elderly.phoneNumber）→ 老人视角
- 否则若“绑定 relative”（前端通过手机号或邮箱匹配 relative.phone/email）→ 家属视角（并关注 relative.elderlyId 对应老人）
- 否则 → 通用 USER 视角

---

## 3. 全局测试要点（建议每次演示都检查）

- 接口响应统一包裹格式：`{ code, message, data }`，前端会把 `code !== 200 && code !== 201` 视为错误。
- token：登录成功后会写入 localStorage，并通过 `Authorization` 请求头发送。
- 基础路径：后端 context-path 为 `/api`，前端 axios baseURL 固定指向 `http://localhost:8080/api`。

---

## 4. 模块演示脚本（UI 路径 + 关键测试点）

### 4.1 登录页（/login）

UI 操作：
1) 打开 `http://localhost:5173/login`
2) 选择任一账号登录（建议先 admin）

测试点：
- 登录成功后跳转到 role 默认入口
- 刷新页面不掉线（token 仍在 localStorage）
- 退出登录：点击右上角“退出”按钮，清理本地登录态并返回登录页

### 4.2 管理员入口（/admin）

UI 操作：
- 使用 admin 登录后默认进入 /admin

说明：
- 当前 Dashboard 主要为展示型页面（偏静态/示例数据），用于演示信息架构与入口。

备注：
- 兼容历史路径：访问 /dashboard 会自动重定向到 /admin。

### 4.3 USER 端入口（/app/**）

定位：
- 老人 / 家属视角的个人端入口

UI 操作：
1) 使用 user 登录后默认进入 /app
2) 底部 4 个入口：首页 / 健康 / 服务 / 我的

测试点：
- 页面不出现“管理/新增/删除”等字样
- 首页为入口卡片布局（含“紧急求助”大按钮），并会根据绑定关系呈现不同文案（老人/家属/通用）
- /app/health 会在“已绑定老人/家属”时调用健康记录接口，默认按绑定关系确定 elderlyId 参数（UI 结构保持一致）
- /app/service 仅调整标题与说明文案（仍为占位示例，不做功能分裂）
- /app/me 展示当前视角说明（老人/家属/通用）与关联信息（只读）

如何演示三种视角（不改登录与守卫、不新增角色）：
- 通用 USER 视角：直接用 user 登录即可
- 老人视角：用 admin 登录 → /elder → 新增老人，填写 phoneNumber 为 user 的手机号（例如 13800138004）→ 再用 user 登录 / 刷新 /app
- 家属视角：用 admin 登录 → /elder → 给任一老人新增亲属 relative，填写 phone 或 email 与 user 的 phone/email 一致 → 再用 user 登录 / 刷新 /app

### 4.4 认证管理（/auth）

UI 操作：
1) 打开 “认证管理”
2) 令牌验证：输入当前 token，点击“验证令牌”
3) 加载认证记录：点击“加载认证记录”，查看登录时间、状态等

测试点：
- Token 验证返回有效/无效
- 认证记录列表能加载、能删除某条 auth 记录

登出（可选）：
- 后端接口为 `POST /auth/logout?authId=xxx`
- 前端已按 query param 方式调用；但 UI 当前未提供登出按钮，如需演示可在浏览器控制台调用对应方法或用 Postman/curl

注册（已对齐后端，可直接演示）：
- 在“用户注册”表单填写：用户名/邮箱/电话/角色/密码
- 点击注册后会：先创建 user，再创建 auth（绑定 userId）

### 4.5 用户管理（/user）

UI 操作：
1) “创建用户”：填写姓名/邮箱/电话/角色（admin/worker/relative）
2) “用户查询”：按 ID/邮箱/电话查询
3) “所有用户”：加载列表
4) 对任一用户：激活/停用/删除

测试点：
- 创建成功后能在列表里看到
- 激活/停用状态切换正确
- 删除后查询不到

### 4.6 老人信息（/elder）

UI 操作：
- Tab 1：老人信息管理
  - 添加老人（必填项齐全）
  - 按 ID 查询 / 按姓名搜索
  - 加载所有老人
  - 激活/停用/删除
- Tab 2：亲属信息管理
  - 添加亲属（需要填写老人ID）
  - 按亲属 ID 查询 / 按老人 ID 查询亲属列表
  - 加载所有亲属
  - 激活/停用/删除

测试点：
- 新建老人后，用老人 ID 给他新增亲属
- 亲属列表能按老人 ID 正确过滤

### 4.7 活动管理（/activity）

UI 操作：
1) 创建活动（含开始/结束时间、组织者ID、状态）
2) 按 ID / 分类 / 状态查询
3) 加载所有活动
4) 激活/停用/删除

测试点：
- 创建后能按条件查到
- 激活/停用按钮逻辑正确（激活后不应再点“激活”）

### 4.8 紧急求助（/emergency）

UI 操作：
1) 创建求助（老人ID、类型、描述、位置、联系电话、优先级）
2) 查询：按 ID、老人ID、状态、优先级
3) 列表：加载所有求助
4) 流程：
   - pending 状态：点击“响应” -> 输入响应人ID
   - responded 状态：点击“解决”

测试点：
- 状态流转：pending → responded → resolved
- “响应”接口后端要求 responderId 为 query param，前端已修正可直接演示

建议的 responderId：
- 可以用 worker 表中的员工 ID（例如初始化数据里常见为 1/2/3/4），也可以用任意数字（后端当前未做外键校验）。

### 4.9 健康管理（/health）

UI 操作：
- 点击“加载健康记录”

测试点：
- 能加载并展示初始化的 health_record 数据

说明：
- 当前页面以“列表展示”能力为主，更多查询/新增/停用等接口可用但 UI 尚未全部暴露。

### 4.10 服务订单（/serviceorder）

UI 操作：
- 点击“加载服务订单”

测试点：
- 能加载并展示初始化的 service_order 数据

说明：
- 当前页面以“列表展示”能力为主；如需演示取消/完成流程，建议用 Postman/curl 调用：
  - `PUT /serviceorder/{id}/cancel`
  - `PUT /serviceorder/{id}/complete`

### 4.11 工作人员（/worker）

UI 操作：
- 点击“加载工作人员”

测试点：
- 能加载并展示初始化的 worker 数据

### 4.12 文件管理（/file）

UI 操作：
- 点击“加载文件记录”

测试点：
- 能加载并展示初始化的 file_record 数据

文件上传（建议用 Postman/curl 演示）：
- 接口：`POST /file/upload`（multipart/form-data）
- 必填：file、uploaderId
- 可选：entityType、entityId

备注：
- 后端会把文件落盘到后端运行目录下的 `uploads/`，并在记录里写入 `url = /files/{filename}`。
- 当前后端未配置 `/files/**` 的静态资源映射，因此“通过 url 直接下载”可能需要额外配置才能生效；但上传与记录入库可用于演示。

---

## 5. 常见问题排查

- 前端报错“请求失败/业务错误”：优先看后端返回的 `message`，以及是否符合 `{code,message,data}` 包装。
- 401/跳回登录：检查 token 是否存在于 localStorage，后端 auth 记录是否被删除/停用。
- 数据为空：确认 MySQL 已执行 DDL + 初始化数据，并且后端 application.properties 指向同一个库。

---

## 6. 推荐演示顺序（10 分钟版本）

1) admin 登录 → /admin（总览）
2) /user：加载用户列表（展示基础 CRUD）
3) /elder：新增老人 + 新增亲属（展示主从数据）
4) /emergency：创建求助 → 响应 → 解决（展示流程状态流转）
5) /activity：创建活动 → 按状态查询
6) /health、/serviceorder、/worker、/file：各点一次“加载”完成收尾

可选加分：
- user 登录 → /app（展示适老化布局与入口卡片）
