👉 **不要做 3 个登录页**
 👉 **不要在登录页写复杂逻辑**
 👉 **不要把“角色差异”散落在各个页面里 if/else**

✅ **正确解法只有一个：**

> **登录统一 → 路由分区 → 布局分区 → 菜单/模块分区**

也就是：
 **“路由即角色边界，Layout 即角色世界观”**

这不是“推翻重构”，而是“结构升级”。在前端 **只认这三种宏角色**（不等于后端 role 表）：

| 前端角色标识 | 说明                             |
| ------------ | -------------------------------- |
| `ADMIN`      | 系统管理员                       |
| `WORKER`     | 工作人员                         |
| `USER`       | 老人 / 家属（UI 一致，权限不同） |

> ⚠️ 前端不要细分 “老人 / 家属” 两套页面
>  👉 那是**后端权限 + 页面可见性**的问题，不是路由世界观

---

# 本仓库落地结论（强确定）

## 结论 1：`/app/**` 只做「入口卡片 + 少数详情页」

✅ 采用：「入口卡片 + 少数详情页」模式

❌ 不复用任何管理页（不做表格型 CRUD / 不做管理列表）

### 为什么这是唯一合理解（结合当前后端事实）

1) 后端没有 RBAC / 读写权限隔离 / 全局权限拦截

- `User.role` 只是字符串字段（示例取值：`admin / manager / staff / user`）
- 后端未按角色限制接口能力，也无只读/可操作区分

👉 若复用管理页到 `/app/**`，将由前端承担“假权限控制”的风险（UX 约束 ≠ 安全边界）。

2) 老人 / 家属不是 role，而是业务实体

- 老人：`elderly`（业务实体）
- 家属：`relative`（业务实体）

👉 `/app/**` 应围绕“个人视角的业务实体”，而不是围绕“系统用户管理”。

## `/app/**` 的最终模块边界（与后端 API 对齐）

> 注意：下面每项都应能在后端找到对应 API（`/api/...`），不做拍脑袋页面。

### `/app/home`（必须有）

- 只做聚合展示，不做管理
- 老人基本信息（elder 模块：elderly）
- 家属关联信息（elder 模块：relative）
- 今日健康摘要（health 只读）
- 服务订单摘要（serviceorder 只读）
- 🆘 紧急求助入口（唯一强操作）

### `/app/health`

- 健康档案查看（只读）
- 历史趋势（只读）
- 不做删除/批量/管理

### `/app/service`

- 我的服务订单：列表（只读）
- 服务详情（只读）
- 评价：允许提交（合理的唯一表单操作之一）

### `/app/emergency`

- 一键求助（强操作）
- 求助历史（只读）

### `/app/profile`

- 账号信息（只读）
- 退出登录

### `/app/**` 明确禁止出现

- ❌ 表格型 CRUD
- ❌ 用户管理
- ❌ 老人管理 / 家属管理
- ❌ 新增 / 删除 老人实体

这些只允许存在于 `/admin/**` 或 `/worker/**`。

---

## 结论 2：必须做「后端 role → 前端宏角色」映射层

✅ 前端宏角色固定为 3 个：`ADMIN / WORKER / USER`

❌ 前端宏角色 **≠** 后端 `User.role` 原值（绝对不能直接用 `admin/manager/staff/user` 去驱动路由与布局）

### 后端事实（前端必须接受）

- 登录接口不返回 role
- Auth 记录不包含 role
- `User.role` 是字符串，且取值与路由语义不等价
- 权限系统未落地

### 唯一合理做法：角色规范化（Role Normalization）

建议新增文件（示例路径）：`o-f/src/shared/roleNormalize.js`

```js
export const RoleNormalizeMap = {
	ADMIN: ['admin'],
	WORKER: ['manager', 'staff'],
	USER: ['user'],
}

export function normalizeRole(userRole) {
	for (const [macro, values] of Object.entries(RoleNormalizeMap)) {
		if (values.includes(userRole)) return macro
	}
	return null
}
```

登录成功后：

1) 用 userId 去取用户信息（`/api/user/...`）拿到 `user.role`
2) 计算宏角色 `macroRole = normalizeRole(user.role)`
3) 只保存宏角色：`localStorage.setItem('role', macroRole)`

从此以后：router / layout / menu / route guard 全部只认 `ADMIN/WORKER/USER`。

---

# 路由按角色“分区”



# 路由按角色“分区”

## 1️⃣ 路由结构升级（这是整个方案的地基）

👉 **改为角色域路由：**

参考：

```
/login                # 唯一入口
/admin/**             # 管理员域
/worker/**            # 工作人员域
/app/**               # 老人 / 家属域
```

------

## 2️⃣ router/index.js 设计原则（非常重要）

### ✅ 一个角色 = 一个 Layout

### ❌ 不允许角色共用 Layout

Layout 是“身份世界观”，children 是“功能模块”**

# Layout 决定“页面气质”

这是**体验提升最明显的一步**。

## 1️⃣ 三个 Layout 的“气质应该完全不同”

| 角色      | 布局特点                 |
| --------- | ------------------------ |
| 管理员    | 左侧 Sidebar + 数据密集  |
| 工作人员  | 左侧简化 + 操作导向      |
| 老人/家属 | 顶部 / 底部导航 + 大按钮 |

### AdminLayout

- 深色侧边栏
- 树状菜单
- 多模块入口

### WorkerLayout

- 精简菜单
- 只暴露“我要做的事”

### AppLayout（老人/家属）

- 大字号
- 高对比
- 卡片化
- **不要出现“管理”字样**

# 菜单 ≠ 路由 ≠ 权限（别混）

**很多人会在这里写炸。**

### 你要遵守这条铁律：

> **路由是结构，菜单是表现，权限是开关**

### 正确做法：

- 路由：写死（/admin/** 永远存在）
- 菜单：根据角色生成
- 权限：控制“能不能点、能不能看到”

###  1（结构）

-  拆出 `layouts/`
-  路由按 `/admin /worker /app` 分区
-  登录后角色重定向

### 2（体验）

-  三套菜单配置
-  Admin / Worker / App 不同 UI 密度
-  老人端字体 & 按钮放大

### 3（打磨）

-  路由守卫（role 校验）
-  非法访问 redirect
-  README 更新「角色路由设计说明」

---

# 任务清单（前端）

> 本清单只针对前端页面与路由结构，不涉及后端改造。

## Phase 0：定义与盘点（必须先做）

1) 定义 `/admin` `/worker` `/app` 的模块归属矩阵（哪些模块出现在谁的域）
2) 盘点所有跳转来源：菜单、按钮、卡片、表格操作、登录成功跳转
3) 落地宏角色映射层：建立 `normalizeRole()`，并确定 role 的来源（用户信息接口）

## Phase 1：路由分区 + Layout 骨架

1) 新建 `o-f/src/layouts/`：AdminLayout、WorkerLayout、AppLayout
2) 将 `o-f/src/router/index.js` 改为三域父路由 + children（一个域一个 Layout）
3) 路由守卫只做两件事：
	- 未登录拦截：回 `/login`
	- 跨域访问：提示 + redirect 到本域默认入口

## Phase 2：App 域页面（卡片入口 + 少量详情）

1) 新建 `o-f/src/modules/app/`（建议）
2) 实现 `/app/home` 作为聚合入口卡片页（不出现管理语义）
3) 只实现必要的少数详情页：health/service/emergency/profile

## Phase 3：菜单与体验打磨

1) 三套菜单配置（菜单生成 ≠ 路由结构）
2) AppLayout 适老化：字体放大、按钮放大、高对比、卡片化

---

# 验收铁律（压缩成一句）

> 路由与布局只认「宏角色」；业务差异只认「业务实体是否存在」。