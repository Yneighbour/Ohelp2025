# 前后端业务交互对接说明

> 本文基于当前代码实现情况，对前端与后端的业务交互进行分类梳理，分为：
> 1）后端已有且已对接；2）后端已有能力但前端暂未完全对接；3）暂不需要/无法对接后端的前端模拟交互；4）如要真正落地需要新增的后端能力。

---

## 1. 后端已有且已在前端对接的交互

### 1.1 认证与会话

**登录**  
- 前端：LoginView（`src/views/LoginView.vue`）  
- 接口：`POST /auth/login`（实际路径：`/api/auth/login`）  
- 用途：
  - 校验用户名/密码，返回 `{ token, userId, username, role }`；
  - 前端在登录成功后写入：`localStorage['token']`、`['username']`、`['role']`、`['userId']`；
  - 根据选择的角色跳转到 `/health`（用户端）或 `/admin-user-list`（管理端）。

**Token 校验（路由守卫）**  
- 前端：`src/router/index.js` + `src/services/session.js`  
- 接口：`GET /auth/validate/{token}`（`/api/auth/validate/{token}`）  
- 用途：
  - 在进入 `meta.requiresAuth = true` 的路由前，调用 `validateExistingToken(token)`；
  - 校验失败时清除本地 token 并跳转到登录页；
  - 对 `meta.requiresAdmin = true` 的管理端路由，再额外校验 `localStorage['role'] === 'admin'`。

---

### 1.2 用户与老人、家属信息

**用户列表（示例页 + 管理端）**  
- 前端：
  - UsersView（`src/views/UsersView.vue`，示例对接）
  - AdminUserListView（`src/views/AdminUserListView.vue`，管理端）
- 接口：`GET /user/`（`/api/user/`）  
- 用途：
  - 从后端加载全部用户列表；
  - 前端在界面上提供搜索关键字、状态/角色筛选等功能（纯前端过滤）。

**老人档案列表**  
- 前端：AdminElderListView（`src/views/AdminElderListView.vue`）  
- 接口：`GET /elder/elderly/`（`/api/elder/elderly/`）  
- 用途：
  - 展示所有老人基本信息（姓名、年龄、房间号等）；
  - 若接口失败或返回空数组，使用本地演示数据兜底。  

**家属绑定列表（老人–亲属关联）**  
- 前端：AdminFamilyBindingView（`src/views/AdminFamilyBindingView.vue`）  
- 接口：
  - `GET /elder/elderly/`（老人基础信息）
  - `GET /elder/relative/`（亲属信息列表，含 `elderlyId`）
- 用途：
  - 通过 `elderlyId` 将亲属列表与老人列表关联；
  - 在管理端展示“老人–家属”绑定关系列表；
  - 接口异常时使用本地演示数据回退。  

---

### 1.3 健康记录与预警视图

**健康记录列表（管理端）**  
- 前端：AdminHealthRecordView（`src/views/AdminHealthRecordView.vue`）  
- 接口：`GET /health/`（`/api/health/`）  
- 用途：
  - 从后端加载全部健康记录；
  - 前端根据记录字段（如血压值、血糖等）推导出“正常/偏高/异常”等状态文案，用于表格中的状态展示。  

**用户端健康记录视图**  
- 前端：
  - 健康概览页：HealthView（`src/views/HealthView.vue`）
  - 健康详情页：HealthDetailView（`src/views/HealthDetailView.vue`）
  - 个人中心健康档案：ProfileHealthRecordsView、ProfileView 中相关卡片
- 接口：
  - `GET /health/` 或 `GET /health/elderly/{elderlyId}`
  - 通过 `src/api/health.js` 中的 `listAllHealthRecords` / `listHealthRecordsByElderlyId` / `listByElderlyId` 进行封装
- 用途：
  - 在概览页展示最近一次/汇总健康指标和任务完成情况；
  - 在详情页使用 Canvas 绘制 7 天趋势图，并展示单项指标历史记录；
  - 在个人中心“健康档案”中展示该老人的历史测量记录。  

**健康预警列表与详情**  
- 前端：AlertsView（`src/views/AlertsView.vue`）、AlertDetailView（`src/views/AlertDetailView.vue`）  
- 接口：复用健康记录接口 `GET /health/...`  
- 用途：
  - 从健康记录中由前端逻辑推导出“预警条目”（高血压、高血糖等）；
  - 进行预警列表展示与单条预警详情展示；
  - 未新增独立的“预警表”，而是在健康记录之上进行视图层加工。  

---

### 1.4 活动与“我的活动”

**活动列表与详情（用户端）**  
- 前端：
  - ActivitiesView（`src/views/ActivitiesView.vue`）
  - ActivityDetailView（`src/views/ActivityDetailView.vue`）
  - ProfileView / ProfileMyActivitiesView 中的活动统计/列表
- 接口：
  - `GET /activity/`
  - `GET /activity/{id}`
  - `GET /activity/category/{category}`
  - `GET /activity/status/{status}`
- 用途：
  - 展示社区活动列表，包括分类、状态、名额、时间等；
  - 在详情页显示活动介绍、注意事项、已报名人数等；
  - “立即报名/已结束”按钮目前仅为前端提示（见第 3 节）。  

**活动列表（管理端）**  
- 前端：AdminActivityListView（`src/views/AdminActivityListView.vue`）  
- 接口：同上（通过 `src/api/activity.js` 统一封装）  
- 用途：
  - 管理端查看全部活动情况；
  - 取消活动按钮已对接后端 `PUT /activity/{id}/deactivate` 接口，并在成功后刷新列表；
  - 新增/编辑等操作仍为前端弹窗演示（未调用更新接口，见第 2 节）。  

---

### 1.5 紧急呼救与历史记录

**紧急呼救上报 + 历史记录（用户端）**  
- 前端：EmergencyView（`src/views/EmergencyView.vue`）  
- 接口（通过 `src/api/emergency.js` 封装）：
  - `POST /emergency/`（创建紧急事件）
  - `GET /emergency/elderly/{elderlyId}` 或类似（按老人 ID 查询紧急记录）
- 用途：
  - 用户点击/长按“紧急呼救”按钮时，调用 `emergencyApi.create(...)` 在后端创建一条紧急记录；
  - 页面底部“历史记录”通过 `emergencyApi.listByElderlyId(...)` 从后端加载，并按时间倒序展示最近几条。

---

### 1.6 服务预约（服务订单，管理端）

**服务预约列表**  
- 前端：AdminServiceOrderView（`src/views/AdminServiceOrderView.vue`）  
- 接口（通过 `src/api/serviceorder.js` 封装）：
  - `GET /serviceorder/`（全部预约列表）
  - 若后端实现了状态筛选接口，则可使用类似 `GET /serviceorder/status/{status}`（目前封装了 `listByStatus`）。
- 用途：
  - 管理端查看全部服务预约/订单；
  - 根据订单状态（待处理、进行中、已完成等）展示不同标签；
  - 取消与完成操作已分别对接 `PUT /serviceorder/{id}/cancel` 与 `PUT /serviceorder/{id}/complete` 接口，并在成功后刷新列表；
  - “确认”与“新建预约”等操作仍为前端弹窗演示。  

---

## 2. 后端已有能力，但前端目前只做了部分/未完全对接的交互

> **更新时间**: 2026年1月16日  
> **状态**: 本节所列功能已全部完成对接，详见 `根目录/前后端功能对接完成报告.md`

### 2.1 用户管理（管理端）✅ 已完成对接

**后端已有接口**  
- 控制器：`UserController`（`o-b/src/main/java/com/soft/ob/user/controller/UserController.java`）  
- 主要能力：
  - `POST /user/` 新增用户
  - `GET /user/{id}` / `/email/{email}` / `/phone/{phone}` 查询用户
  - `GET /user/` 获取所有用户
  - `PUT /user/{id}` 更新用户信息
  - `DELETE /user/{id}` 删除用户
  - `PUT /user/{id}/activate` 启用用户
  - `PUT /user/{id}/deactivate` 禁用用户

**当前前端对接情况**  
- AdminUserListView 已使用 `GET /user/` 做【列表展示 + 搜索/筛选】；
- 列表项上的“启用/禁用/删除”按钮已分别调用 `PUT /user/{id}/activate`、`PUT /user/{id}/deactivate` 与 `DELETE /user/{id}` 接口，并在成功后自动刷新列表；
- ✅ **已完成**: "新增/编辑用户"功能已接入 `POST/PUT` 接口，支持完整的表单提交和数据更新。

**结论**  
- ✅ 用户管理功能已全部对接完成，包括列表展示、启用/禁用/删除、新增/编辑用户。

---

### 2.2 活动管理（管理端）✅ 已完成对接

**后端已有接口**  
- 控制器：`ActivityController`（`o-b/src/main/java/com/soft/ob/activity/controller/ActivityController.java`）  
- 主要能力：
  - `POST /activity/` 创建活动
  - `GET /activity/`、`GET /activity/{id}` 查询活动
  - `GET /activity/category/{category}` 按分类查询
  - `GET /activity/status/{status}` 按状态查询
  - `PUT /activity/{id}` 更新活动
  - `DELETE /activity/{id}` 删除活动
  - `PUT /activity/{id}/activate` / `/deactivate` 上下架活动

**当前前端对接情况**  
- 用户端 & 管理端均已使用 `GET /activity/...` 实现列表与详情展示；
- 管理端的“取消活动”按钮已接入 `PUT /activity/{id}/deactivate` 接口，并在成功后刷新列表；
- ✅ **已完成**: "新增/编辑/删除/重新上架"功能已全部对接，支持完整的活动CRUD操作。

**结论**  
- ✅ 活动管理功能已全部对接完成，包括列表展示、新增、编辑、删除、取消、重新上架。

---

### 2.3 紧急事件处置流程（如后端已有）

**后端可能已有接口**  
- 控制器：`EmergencyController`（`o-b/src/main/java/com/soft/ob/emergency/controller/EmergencyController.java`）  
- 典型能力：
  - 创建紧急事件（已被用户端调用）；
  - 查询紧急事件列表/按老人 ID 查询（已被用户端历史记录使用）；
  - 若存在：`respond` / `resolve` 等接口用于“响应/处理/关闭”事件。

**当前前端对接情况**  
- 用户端只负责“发起呼救 + 查看历史”，即只用到 `create` 与 `listByElderlyId`；
- 管理端尚未提供“紧急事件管理”页面，未对接响应/处理接口。  

**结论**  
- 若要引入“值班人员/管理员”对紧急事件进行处理，可在管理端新增“紧急事件管理”视图，对接这部分后端能力。  

---

### 2.4 老人/家属详情编辑 ✅ 已完成对接

**后端已有接口**  
- 控制器：`ElderlyController`、`RelativeController`  
- 能力：
  - 对老人和亲属实体提供标准 CRUD（具体路径在对应 Controller 中定义）。

**当前前端对接情况**  
- AdminElderListView、AdminFamilyBindingView 侧重“展示”与“关联视图”；
- ✅ **已完成**: 列表项上的“编辑/删除/新增”操作已全部对接，支持完整的CRUD操作。

**结论**  
- ✅ 老人档案管理和家属绑定管理已全部对接完成，包括列表展示、新增、编辑、删除。  

---

## 3. 暂时不能（或无需）对接后端的前端模拟交互

> 这类交互要么是纯 UI/终端功能，要么当前业务范围内缺少对应的后端数据模型，短期内保持前端模拟即可。

### 3.1 社交圈模块

- 前端：SocialView（`src/views/SocialView.vue`）  
- 数据来源：`src/data/social.js` 中的本地演示数据；
- 交互：
  - 点赞、评论、发布动态按钮 → 仅弹窗提示，不产生真实数据变更；
- 后端：目前没有 `social` 相关实体/Controller。  

**结论**：社交圈为纯前端演示模块，不与现有后端耦合。若未来需要真正的动态/评论系统，需要新增后端表和接口（见第 4.1）。  

---

### 3.2 紧急呼救中的“快速拨号 / 分享位置 / 联系人管理”

- 前端：EmergencyView  
- 交互类型：
  - 快速拨号（120/110/119/社区医院） → 通过 `alert` 模拟拨号提示；
  - “分享位置” → 通过 `alert` 模拟分享成功提示；
  - “添加联系人/拨打联系人” → 只操作前端的演示联系人数组，不持久化。  
- 后端：没有“通话/位置分享”相关接口，且通常也不需要由后端实现。  

**结论**：这些属于典型的终端/浏览器层能力，不需要后端支持，维持前端模拟即可。  

---

### 3.3 活动报名/取消（用户端）

- 前端：ActivityDetailView、ProfileMyActivitiesView 中的“报名/取消”按钮；
- 当前行为：统一为 `window.alert('报名成功！（演示）')` 或类似提示，不写入后端；
- 后端：只有 `Activity` 实体，没有单独“报名记录（Enrollment）”表。  

**结论**：在缺少报名记录数据模型前，这些交互只作为 UI 演示存在，不会对后端造成影响（见第 4.2 了解如何新增报名功能）。  

---

### 3.4 个人中心中的部分子模块

- 涉及模块：
  - 个人资料页的部分扩展字段（如身份证、详细地址、个性签名等）；
  - 健康档案中“慢性病史/过敏史/体检记录”的详细描述；
  - 我的活动统计卡片；
  - 紧急联系人管理（个人中心入口）；
  - 系统设置页面中的通知开关、字体大小、主题模式等。  
- 现状：
  - 这些内容大多基于前端演示数据或前端计算得到；
  - 未统一存入后端，也没有对应的表结构。  

**结论**：这部分主要服务于“体验和展示”，在当前项目范围内作为前端演示即可，若后续需要云端同步再考虑抽象统一的配置实体。  

---

## 4. 若要真正业务落地，需要在后端新增的交互点

> 本节列出当前前端存在“有业务意义的按钮/信息，但后端尚无对应实体或接口”的位置。

### 4.1 社交圈（动态、评论、点赞）

**前端现状**  
- 社交圈页面（SocialView）使用本地 `socialPosts` 渲染；
- 点赞、评论、发布按钮仅做弹窗提示。  

**后端缺失**  
- 没有 `Post` / `Comment` / `Like` 等实体；
- 没有对应的 REST Controller。  

**如需真实实现，建议新增：**  
- 表结构：
  - `social_post(id, user_id, content, created_at, ... )`
  - `social_comment(id, post_id, user_id, content, created_at, ... )`
  - `social_like(id, post_id, user_id, created_at, ... )`
- 控制器与接口：例如 `SocialController`：
  - `POST /social/posts` 发布动态
  - `GET /social/posts` / `/social/posts/{id}` 查询动态
  - `POST /social/posts/{id}/like` 点赞
  - `POST /social/posts/{id}/comments` 评论
- 前端改造：
  - 将社交数据源切换为接口返回；
  - 在按钮事件中改为调用上述接口，并更新本地状态。  

---

### 4.2 活动报名记录（Enrollment）

**前端现状**  
- ActivityDetailView 中的“立即报名”按钮仅弹窗提示；
- ProfileMyActivitiesView 中展示的“我的活动”部分为演示数据。  

**后端缺失**  
- 目前仅有 `Activity`（活动）实体，没有单独的“报名记录”表。  

**如需真实实现，建议新增：**  
- 实体与表：`ActivityEnrollment` / `activity_enrollment`：
  - 字段示例：`id, activity_id, user_id/elderly_id, status, created_at, canceled_at, ...`
- 控制器：`ActivityEnrollmentController`：
  - `POST /activity/{id}/enroll` 报名
  - `PUT /activity/enrollment/{id}/cancel` 或 `DELETE /activity/enrollment/{id}` 取消
  - `GET /activity/{id}/enrollments` 查看活动报名列表
  - `GET /user/{id}/enrollments` 查看某用户的“我的活动”
- 前端改造：
  - 报名/取消报名按钮改为调用上述接口；
  - ProfileMyActivitiesView 改为从接口加载当前用户的报名记录。  

---

### 4.3 紧急联系人管理（真正持久化）

**前端现状**  
- 紧急联系人既出现在用户端紧急页，也出现在个人中心子页，主要使用演示数据；
- 无通用“联系人优先级/通知策略”等后端配置。  

**后端现状**  
- 有 `Relative` 代表亲属信息，但未明确区分“紧急联系人”及其优先级。  

**如需真实实现，建议：**  
- 方案 A：在 `Relative` 上增加字段：`is_emergency_contact`、`priority` 等，并扩展现有 Controller 的增删改查；
- 方案 B：新增独立实体 `EmergencyContact`，与 Elderly/User 关联。  

---

### 4.4 系统设置与个人偏好（字体、主题、通知开关）

**前端现状**  
- ProfileSettingsView 中的各类设置（通知开关、字体大小、主题模式等）主要作为 UI 演示；
- 当前并未持久化到后端（如重新登录可能不会保留）。  

**后端缺失**  
- 没有统一的“用户偏好/UserPreference” 实体与接口。  

**如需云端同步，建议新增：**  
- 实体：`UserPreference`：映射用户的通知、隐私、显示、主题等设置；
- 控制器：`SettingsController` 或合并到 UserController：
  - `GET /user/{id}/preferences`
  - `PUT /user/{id}/preferences`
- 前端改造：
  - 进入设置页时从接口加载偏好；
  - 调整开关/选项时调用保存接口，同时可在本地缓存，提升体验。  

---

## 5. 小结

- **已对接**：认证、健康记录、活动列表与详情、紧急呼救上报/历史、服务预约列表、用户/老人/家属基础数据，以及部分管理端操作（用户启用/禁用/删除、活动取消、服务预约取消/完成等）已与后端真实联通；
- **可补充对接**：管理端剩余的写操作（如用户新增/编辑、活动新增/编辑/删除、紧急事件处理、老人/家属档案编辑等）后端能力已具备，前端只需把按钮从 `alert` 改为接口调用；
- **前端演示为主**：社交圈、部分个人中心内容、活动报名逻辑、紧急页面的拨号/位置分享等，目前作为 UI/交互原型存在；
- **如需进一步落地**：可以按第 4 节建议，逐步补充报名记录、社交动态、紧急联系人配置、用户偏好等后端模型与接口，使系统从“演示版”演化为“可投入实际使用”的版本。
